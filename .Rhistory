geom_bar(aes(x = made_minute, y = rtMeanSqrError, stat = 'identity'))
errors %>%
select(-count, -diffError) %>%
gather(key = errorType, value = rtMeanSqrError, rtmeanSqrErrorN, rtmeanSqrErrorO) %>%
ggplot() +
geom_bar(aes(x = made_minute, y = rtMeanSqrError))
errors %>%
select(-count, -diffError) %>%
gather(key = errorType, value = rtMeanSqrError, rtmeanSqrErrorN, rtmeanSqrErrorO) %>%
ggplot() +
geom_line(aes(x = made_minute, y = rtMeanSqrError))
errors %>%
select(-count, -diffError) %>%
gather(key = errorType, value = rtMeanSqrError, rtmeanSqrErrorN, rtmeanSqrErrorO) %>%
ggplot() +
geom_line(aes(x = made_minute, y = rtMeanSqrError, color = errorType))
t = 'liverpool-bayern'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
t = 'city-schalke'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
ties = winprob %>%
group_by(season, round, tie)
ties = winprob %>%
group_by(season, round, tie) %>%
n()
ties = winprob %>%
group_by(season, round, tie) %>%
count()
View(ties)
t = 'schalke-city'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
y = 2019
r = 'first'
t = 'tottenham-dortmund'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
schalke-city
y = 2019
r = 'first'
t = 'schalke-city'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
y = 2019
r = 'first'
t = 'roma-porto'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
t = 'ajax-madrid'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
t = 'united-psg'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
y = 2017
r = 'first'
t = 'psg-barcelona'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t)
ties %>%
filter(n %in% c(184,217))
ties %>%
filter(!(n %in% c(184,217)))
cut_interval(winprob$odds)
cut_interval(winprob$odds, 20)
cut_interval(winprob$odds, 20) %>% distinct()
cut_interval(winprob$odds, 20)
winprob %>%
mutate(probrange = cut_interval(odds, 20))
winprob %>%
select(made_minute, odds) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise()
winprob %>%
select(made_minute, odds) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange)
winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange)
winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n())
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n())
proberror
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(probcut = str_extract(probrange, ",.*//]"))
proberror
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(probcut = str_extract(as.character(probrange), ",.*//]"))
proberror
proberror$probrange
as.character(proberror$probrange)
str_extract(as.character(proberror$probrange))
str_extract(as.character(proberror$probrange), ',.*//]')
str_extract(as.character(proberror$probrange), '//,.*//]')
str_extract(as.character(proberror$probrange), ',.*]')
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(probcut = str_extract(as.character(probrange), ",.*]"))
proberror
str_extract(
as.character(probrange),
",.*]"
),
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(
probcut = str_sub(
str_extract(
as.character(probrange),
",.*]"
),
start = 2,
end = -1
)
)
proberror
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(
probcut = str_sub(
str_extract(
as.character(probrange),
",.*]"
),
start = 2,
end = -2
)
)
proberror
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(
probcut = as.numeric(
str_sub(
str_extract(
as.character(probrange),
",.*]"
),
start = 2,
end = -2
)
)
)
proberror
proberror %>%
ggplot() %>%
geom_point(aes(probcut, actualprob))
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(
probcut = as.numeric(
str_sub(
str_extract(
as.character(probrange),
",.*]"
),
start = 2,
end = -2
)
)
)
proberror %>%
ggplot() +
geom_point(aes(probcut, actualprob))
model.odds = locfit(
t1win ~ made_minute + t1goaldiff + t1awaygoaldiff +
homewing1 + homewing2 + stoppagetime,
data = matrix,
family = 'binomial'
)
winprob = matrix %>%
mutate(
neutral = predict(model.simple, newdata = ., type = "response"),
odds = predict(model.odds, newdata = ., type = "response")
) %>%
select(season, round, tie, t1win, made_minute, neutral, odds)
winprob = winprob %>%
mutate(
errorN = t1win - neutral,
errorO = t1win - odds,
sqrErrorN = errorN^2,
sqrErrorO = errorO^2
)
winprob = matrix %>%
mutate(
neutral = predict(model.simple, newdata = ., type = "response"),
odds = predict(model.odds, newdata = ., type = "response")
) %>%
select(season, round, tie, t1win, made_minute, neutral, odds) %>%
mutate(
errorN = t1win - neutral,
errorO = t1win - odds,
sqrErrorN = errorN^2,
sqrErrorO = errorO^2
)
errors = winprob %>%
group_by(made_minute) %>%
summarise(
count = n(),
rtmeanSqrErrorN = sqrt(mean(sqrErrorN)),
rtmeanSqrErrorO = sqrt(mean(sqrErrorO))
) %>%
mutate(diffError = rtmeanSqrErrorN - rtmeanSqrErrorO)
errors %>%
select(-count, -diffError) %>%
gather(key = errorType, value = rtMeanSqrError, rtmeanSqrErrorN, rtmeanSqrErrorO) %>%
ggplot() +
geom_line(aes(x = made_minute, y = rtMeanSqrError, color = errorType))
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(
probcut = as.numeric(
str_sub(
str_extract(
as.character(probrange),
",.*]"
),
start = 2,
end = -2
)
)
)
proberror %>%
ggplot() +
geom_point(aes(probcut, actualprob))
y = 2017
r = 'first'
t = 'psg-barcelona'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
View()
y = 2017
r = 'first'
t = 'psg-barcelona'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
library(locfit)
library(tidyverse)
matrix  = read_csv('minute-matrix.csv')
head(matrix)
tail(matrix)
model.simple = locfit(
t1win ~ made_minute + t1goaldiff + t1awaygoaldiff,
data = matrix,
family = 'binomial'
)
model.odds = locfit(
t1win ~ made_minute + t1goaldiff + t1awaygoaldiff +
homewing1 + homewing2 + stoppagetime,
data = matrix,
family = 'binomial'
)
# rhs = lp(matrix$made_minute, matrix$t1goaldiff, matrix$t1awaygoaldiff,
#          matrix$homewing1, matrix$awaywing1, matrix$homewing2, matrix$awaywing2)
#
# model.odds = locfit.raw(
#   x = rhs,
#   y = matrix$t1win,
#   family = 'binomial'
# )
winprob = matrix %>%
mutate(
neutral = predict(model.simple, newdata = ., type = "response"),
odds = predict(model.odds, newdata = ., type = "response")
) %>%
select(season, round, tie, t1win, made_minute, neutral, odds) %>%
mutate(
errorN = t1win - neutral,
errorO = t1win - odds,
sqrErrorN = errorN^2,
sqrErrorO = errorO^2
)
errors = winprob %>%
group_by(made_minute) %>%
summarise(
count = n(),
rtmeanSqrErrorN = sqrt(mean(sqrErrorN)),
rtmeanSqrErrorO = sqrt(mean(sqrErrorO))
) %>%
mutate(diffError = rtmeanSqrErrorN - rtmeanSqrErrorO)
errors %>%
select(-count, -diffError) %>%
gather(key = errorType, value = rtMeanSqrError, rtmeanSqrErrorN, rtmeanSqrErrorO) %>%
ggplot() +
geom_line(aes(x = made_minute, y = rtMeanSqrError, color = errorType))
proberror = winprob %>%
select(made_minute, odds, t1win) %>%
mutate(probrange = cut_interval(odds, 20)) %>%
group_by(probrange) %>%
summarise(actualprob = sum(t1win) / n()) %>%
mutate(
probcut = as.numeric(
str_sub(
str_extract(
as.character(probrange),
",.*]"
),
start = 2,
end = -2
)
)
)
proberror %>%
ggplot() +
geom_point(aes(probcut, actualprob))
y = 2017
r = 'first'
t = 'psg-barcelona'
winprob %>%
filter(season == y) %>%
filter(round == r) %>%
filter(tie == t) %>%
gather(key = winprobmodel, value = winprob, neutral, odds) %>%
ggplot(aes(made_minute, winprob, color=winprobmodel)) +
geom_line() +
scale_y_continuous(limits = c(0,1)) +
scale_x_continuous(
breaks = c(0, 46, 92, 138, 184),
labels = c('g1 start','g1 half','g2 start','g2 half','end')
) +
theme_minimal() +
xlab("Minutes left") +
ylab("Win probability")
