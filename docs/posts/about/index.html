

<!doctype html>
<html lang="en" class='h-100'>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="Ryan Menezes">
    <meta name="description" content="">

    <link rel="stylesheet" href="/tiepredict/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/tiepredict/static/css/custom.css">
    <link rel="shortcut icon" href="/tiepredict/static/img/soccer-ball.png" type="image/x-icon">
    
    

    <title>About this project - tiepredict</title>
  </head>

  <body class='d-flex flex-column h-100'>
    <header>
      
      <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="/tiepredict/">tiepredict</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/tiepredict/posts/about/">About</a>
            </li>
            <li class="nav-item ">
              <a class="nav-link" href="/tiepredict/ties/">Ties</a>
            </li>
            <li class="nav-item ">
              <a class="nav-link" href="/tiepredict/teams/">Teams</a>
            </li>
            <li class="nav-item ">
              <a class="nav-link" href="/tiepredict/goals/">Goals</a>
            </li>
            <li class="nav-item ">
              <a class="nav-link" href="/tiepredict/seasons/">Seasons</a>
            </li>
          </ul>
        </div>
      </nav>
      
    </header>

    <main role="main" class="flex-shrink-0" style='margin-bottom: 15px;'>
      
      <div class='container'>
        <div class='row liveties'>
  <div class='col-12'>
    <p><strong>Upcoming or in-progress ties:</strong> <a href='/tiepredict/ties/2021-cl-1k-5sf-real-madrid-chelsea/'>Real Madrid v. Chelsea</a> | <a href='/tiepredict/ties/2021-cl-1k-5sf-paris-s-g-manchester-city/'>Paris S-G v. Manchester City</a> | <a href='/tiepredict/ties/2021-el-1k-8sf-villarreal-arsenal/'>Villarreal v. Arsenal</a> | <a href='/tiepredict/ties/2021-el-1k-8sf-manchester-utd-roma/'>Manchester Utd v. Roma</a></p>
  </div>
</div>

        <h1>About this project</h1>

        

        

        
<p>Welcome to <strong>tiepredict</strong>. This website serves as the home of the results of a win probability model for European club football created by me, <a href="https://ryanvmenezes.github.io/about/">Ryan Menezes</a>, a data analyst and coder based in America growing increasingly obsessed with the sport.</p>

<p>The model aims to forecast the outcome in a specific kind of contest: One where each team plays a home match, and the winner is determined by the total number of goals scored across the two matches. This is referred to as a <a href="https://en.wikipedia.org/wiki/Two-legged_tie">two-legged tie</a>, hence <strong>tie</strong>predict. (We might call such matchups a home-and-away series in America, where the term "tie" is mainly used to refer to a game where the score ends level, an outcome more typically referred to as a "draw" in the rest of the world. Luckily there's absolute harmony across the world when it comes to what to call the sport that is the focus of this project.)</p>

<p>More details will follow in this post but here's a brief summary of how this project came together: Using the R programming language, I started by scraping match information from <a href="https://fbref.com/en/">FBref</a>, a burgeoning resource for global soccer statistics. I also scraped data on the betting odds of each match from <a href="https://www.oddsportal.com/soccer/europe/champions-league/">OddsPortal</a> to assess the relative strength of each team. After organizing and combining the data, I attempted some predictive modeling in R to forecast the winner of the tie. Once I felt comfortable with the predictions I was getting, I created this website to publish hundreds of <a href="/tiepredict/ties/2017-cl-1k-3r16-sevilla-leicester-city/">win</a> <a href="/tiepredict/ties/2016-cl-0q-1fqr-red-imps-santa-coloma/">probability</a> <a href="/tiepredict/ties/2019-el-0q-1fqr-cs-fola-esch-fc-prishtina/">charts</a>.</p>

<p>I focused specifically on matches where the <a href="https://en.wikipedia.org/wiki/Away_goals_rule">"away goals rule"</a> applies. I am endlessly fascinated by this rule. There is no equivalent that I know of in American sports, where all points, goals or runs are inherently equal. It adds a layer of distortion I'm still not totally comfortable with: I see a 2-2 scoreline and my mind thinks it's an even contest, but I also know it's not the case. I was initially interested in quantifying the impact of the away goal before deciding to do something more expansive.</p>

<p>Right now, this project covers matches in UEFA's Champions League and Europa League. It will hopefully be expanded to include other competitions, such as the UEFA Women's Champions League and CONMEBOL's Copa Libertadores, as I gather more data.</p>

<h2>Why did I do this?</h2>

<p>As I mentioned earlier, I'm a relative newcomer to soccer, having picked up watching the sport around 2015 after an upbringing spent immersed in the most popular American sports. Now, I set alarms for weekend mornings so I can wake up to watch England's Premier League, and any other interesting European matches for which I have time. Having started watching just a few years ago, I feel like I have a lot of catching up to do. And when it comes time to doing any research, for my job or otherwise, I turn to data as much as I can.</p>

<p>I was also motivated to learn more about the world of football beyond Europe's most glamorous continental matches. Many people start watching the Champions League around the 32-team group stage, but the competition has really been going on for months before that, involving dozens more teams. The champion from each of Europe's domestic leagues gets a spot in the tournament, even tiny Gibraltar. Then there's the Europa League, which commands far fewer attention but globally but has always captivated me. It's mostly free of big-monied teams, which makes for more competitive matches, oftentimes in remote parts of the world I can only imagine. Whether it was the Champions League or Europa League, knockout rounds or qualifying rounds, I wanted to take a look at all of it. By taking a complete view of the data, I learned more about the teams and where they come from.</p>

<p>Win probability models, which are somewhat ubiquitous in sports these days, have also long fascinated me. My undergraduate degree was in statistics, and while predictive modeling has never been my strong suit, I immediately saw that win probability was just a type of model. It asks a simple question: Who will win the game? And it uses a number of inputs about the game to estimate each team's chances. These days, ESPN puts win probability charts <a href="https://www.espn.com/nba/game/_/gameId/401307677">alongside box scores</a> of most sports (though not soccer matches). But I had not seen a model specifically meant to chart the outcome of a two-legged tie.</p>

<p>So I wanted to do it to pique my statistical interests, but also because I see a win probability chart as telling a <em>story</em>. As a journalist, I'm interested in good stories, and I think that these charts provide a distillation of the many complicated factors in a particular game. I wouldn't stare at a live win probability chart instead of watching a game or anything, but if I'm trying to get a broad overview of what went on in a game, I check how the win probability fluctuated. And as I mentioned before, I'm playing catchup here with football.</p>

<p>I saw building a win probability model and churning out graphs as a way to tell some of the stories that I had missed. And it's unearthed some interesting ones. Many people probably watched Barcelona's <a href="/tiepredict/ties/2017-cl-1k-3r16-paris-s-g-barcelona/">remarkable comeback</a> against Paris Saint-Germain in 2017. But far fewer were tuned in when a tiny Maltese side named Gżira United <a href="/tiepredict/ties/2020-el-0q-1fqr-gzira-united-hajduk-split/">stunned</a> a much more established Croatian team early in Europa League qualifying in 2019, a feat my model rates as <a href="/tiepredict/ties/comeback/">the greatest comeback</a> out of the more than 1,400 matches I've gathered data for. You can <a href="https://www.youtube.com/watch?v=zfDeZs_WBSY">see the sheer joy</a> on the face of the Gżira's Ivorian striker, whose two spectacular goals in Croatia led his team to a win on away goals. This might be the pinnacle of that player's career and <a href="https://timesofmalta.com/articles/view/we-made-history-gzira-knock-out-hajduk-split-in-europa-league.722890">the best night ever for his club</a>. This win probability model is one way of capturing it.</p>

<h2>How does the model work?</h2>

<p>I settled on a modeling approach laid out in FiveThirtyEight's <a href="https://fivethirtyeight.com/methodology/how-our-club-soccer-predictions-work/">methodology for its club soccer predictions</a> and further helpfully explained by <a href="https://github.com/lbenz730/soccer_hfa">Luke Benz's research</a> into shrinking home-field advantage at fan-less soccer matches.</p>

<p>A few inputs go into this model. These data points were both simple enough to be gathered from the data that was out there and, in my mind, powerful enough to predict the outcome:</p>

<ul>
<li>The time that has elapsed in the tie</li>
<li>Who the home team was in the tie</li>
<li>The goal difference between the two teams</li>
<li>The away goal difference between the two teams</li>
<li>The difference in the number of players on the field in a game</li>
<li>The pre-match betting odds for the first leg of the tie</li>
</ul>

<p>There are a few intermediate steps before I arrived at a win probability.</p>

<p>First of all, this modeling approach predicts <em>the number of goals left in the tie</em> based on the above inputs, following a Poisson regression model implemented in R. Fitting data to a <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a> is called for when the values are discrete (as in integers, not fractions) and typically skewed to the right (mainly bunched up among low values like 0 or 1). That describes soccer goal-scoring tallies almost perfectly.</p>

<p>Secondly, there is not one model but rather hundreds that eventually come together as one. I implemented a version of "localized" regression by calculating different models for each minute of the match. Early in the tie, the models look at 10 minutes of data before and after the minute in focus. Later on, the window shrinks to three minutes. In minutes 178, 179 and 180, the prediction is based on just the data in those minutes.</p>

<p>After training the model and generating the predicted goals left for every minute in the tie, I used that as the mean (also known as the lambda) of a Poisson distribution. This is the bridge from goals to probabilities. For example, if the model said a particular team had an expectation of 1.5 goals left in the remainder of the tie, this would translate to about a 22% chance of the team scoring 0 goals, a 33% chance of one goal, a 25% chance of two goals, a 13% chance of 3 goals, a 5% chance of four goals, and so on. With those probability distributions for every minute of the tie in hand, I arrived at the final win probability metric.</p>

<p>My approach to modeling win probability changed many times as I worked on this. The <a href="https://github.com/ryanvmenezes/tiepredict/tree/master/model">model folder</a> of my GitHub repo serves as a living document of my successes and many failures with each attempt. It's a messy collection of scripts, but I wanted to preserve a paper trail of all my work. I'm always trying to learn more from the world of statistics but I've sometimes found actual code hard to come by when trying to get started doing predictive modeling, so I wanted to preserve all the work I had done in the hopes that others may be able to learn from it.</p>

<h2>Where do the data come from?</h2>

<p>Primarily from the two sources mentioned above: FBref and Odds Portal.</p>

<p>The first thing I needed to do this was the basic information on how the match went. Namely, when the goals were scored (and to a lesser extent, when any player was red carded, if any). I examined a few sources for match data (including Wikipedia, which presents information in <a href="https://en.wikipedia.org/wiki/2018%E2%80%9319_UEFA_Champions_League_knockout_phase#Round_of_16">neat tables</a>) before settling on FBref because I found FBref data to be clean, authoritative and comprehensive. Not only did it cover notable fixtures with lots of eyeballs on them, but it also provided information on the qualifying rounds of the competitions, for both the Champions League and Europa League.</p>

<h2>How was all of this done?</h2>

<p>TK</p>


      </div>
      
    </main>

    
    <footer class="footer mt-auto py-3" style="background-color:#f5f5f5;">
      <div class="container text-muted">
        <p><a href="#">Back to top</a></p>
        <p><a href='/tiepredict/posts/about/'>About this project</a></p>
        <p>Match data from <a href='https://fbref.com/en/'>FBref</a>. Odds data from <a href='https://www.oddsportal.com/'>Odds Portal</a>. Flag icons from <a href='https://www.flaticon.com/packs/rectangular-country-simple-flags'>Flaticon</a>.</p>
        <p>Data analysis, web development and digital design by Ryan Menezes. Source code and data files on <a href='https://github.com/ryanvmenezes/futbol-winprob-model'>GitHub</a>.</p>
      </div>
    </footer>
    

    <script src="/tiepredict/static/js/jquery-3.5.1.slim.min.js"></script>
    <script src="/tiepredict/static/js/bootstrap.min.js"></script>
    
    
  </body>
</html>
