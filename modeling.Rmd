---
title: "R Notebook"
output: html_notebook
---

```{r}
library(locfit)
library(tidyverse)
```

```{r}
matrix  = read_csv('minute-matrix.csv')
```

```{r}
head(matrix)
```

```{r}
tail(matrix)
```

```{r}
model.simple = locfit(t1win ~ made_minute + t1goaldiff + t1awaygoaldiff, data = matrix, family = 'binomial')
```


```{r}
rhs = lp(matrix$made_minute, matrix$t1goaldiff, matrix$t1awaygoaldiff,
         matrix$homewing1, matrix$awaywing1, matrix$homewing2, matrix$awaywing2)

model.odds = locfit.raw(
  x = rhs,
  y = matrix$t1win,
  family = 'binomial'
)
```

```{r}
matrix = matrix %>% 
  mutate(
    winprob = predict(model.simple, newdata = ., type = "response")
  )
```


```{r}
y = 2019
r = 'first'
t = 'united-psg'

matrix %>% 
  filter(season == y) %>% 
  filter(round == r) %>% 
  filter(tie == t) %>% 
  ggplot(aes(made_minute, winprob)) +
  geom_line() +
  scale_y_continuous(limits = c(0,1)) +
  theme_minimal() +
  xlab("Minutes left") +
  ylab("Win probability")
```

